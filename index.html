<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Recovery Journey Tracker</title>
    <style>
      :root {
        --primary: #4f46e5;
        --primary-dark: #4338ca;
        --secondary: #06b6d4;
        --success: #10b981;
        --background: #f9fafb;
        --surface: #ffffff;
        --text: #1f2937;
        --text-muted: #6b7280;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, "Open Sans", sans-serif;
      }

      body {
        background-color: var(--background);
        color: var(--text);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      .container {
        width: 100%;
        max-width: 600px;
        margin: 0 auto;
        padding: 2rem 1rem;
        flex: 1;
      }

      header {
        text-align: center;
        margin-bottom: 2rem;
      }

      h1 {
        font-size: 1.8rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
        color: var(--primary);
      }

      .subtitle {
        color: var(--text-muted);
        font-size: 1rem;
      }

      .card {
        background-color: var(--surface);
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        padding: 2rem;
        margin-bottom: 2rem;
        text-align: center;
      }

      .days-counter {
        font-size: 3.5rem;
        font-weight: 700;
        color: var(--primary);
        margin-bottom: 0.5rem;
      }

      .days-label {
        font-size: 1.25rem;
        margin-bottom: 1.5rem;
        color: var(--text);
      }

      .streak-info {
        color: var(--text-muted);
        font-size: 0.9rem;
        margin-bottom: 1.5rem;
      }

      .button {
        background-color: var(--primary);
        color: white;
        border: none;
        border-radius: 8px;
        padding: 0.75rem 1.5rem;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: background-color 0.2s;
      }

      .button:hover {
        background-color: var(--primary-dark);
      }

      .button-danger {
        background-color: #ef4444;
      }

      .button-danger:hover {
        background-color: #dc2626;
      }

      .button-secondary {
        background-color: #f3f4f6;
        color: var(--text);
        margin-left: 0.5rem;
      }

      .button-secondary:hover {
        background-color: #e5e7eb;
      }

      .milestones {
        margin-top: 1rem;
      }

      .milestone {
        display: flex;
        align-items: center;
        margin-bottom: 0.75rem;
        padding: 0.75rem;
        border-radius: 8px;
        background-color: #f3f4f6;
        position: relative;
        transition: all 0.3s ease;
      }

      .milestone:hover {
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .milestone-day {
        font-weight: 600;
        margin-right: 0.5rem;
        color: var(--primary);
        min-width: 40px;
      }

      .milestone-delete {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        background-color: transparent;
        border: none;
        color: #9ca3af;
        cursor: pointer;
        font-size: 1.1rem;
        opacity: 0.6;
        transition: opacity 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 24px;
        height: 24px;
        border-radius: 50%;
      }

      .milestone-delete:hover {
        opacity: 1;
        background-color: rgba(239, 68, 68, 0.1);
        color: #ef4444;
      }

      .milestone-complete {
        background-color: rgba(16, 185, 129, 0.1);
        border-left: 3px solid var(--success);
        transform: scale(1.02);
      }

      .milestone-complete .milestone-day {
        color: var(--success);
      }

      .achievement-message {
        background-color: rgba(16, 185, 129, 0.1);
        color: var(--success);
        padding: 10px;
        border-radius: 8px;
        margin-top: 15px;
        font-weight: 500;
        text-align: center;
        display: none;
        animation: fadeInUp 0.5s ease;
      }

      @keyframes fadeInUp {
        0% {
          opacity: 0;
          transform: translateY(20px);
        }
        100% {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .quote {
        font-style: italic;
        color: var(--text-muted);
        margin: 2rem 0;
        text-align: center;
      }

      footer {
        text-align: center;
        padding: 1.5rem;
        background-color: var(--surface);
        color: var(--text-muted);
        font-size: 0.875rem;
      }

      /* Confetti Animation */
      @keyframes confetti-slow {
        0% {
          transform: translate3d(0, 0, 0) rotateX(0) rotateY(0);
        }
        100% {
          transform: translate3d(25px, 105vh, 0) rotateX(360deg) rotateY(180deg);
        }
      }

      @keyframes confetti-medium {
        0% {
          transform: translate3d(0, 0, 0) rotateX(0) rotateY(0);
        }
        100% {
          transform: translate3d(100px, 105vh, 0) rotateX(100deg)
            rotateY(360deg);
        }
      }

      @keyframes confetti-fast {
        0% {
          transform: translate3d(0, 0, 0) rotateX(0) rotateY(0);
        }
        100% {
          transform: translate3d(-50px, 105vh, 0) rotateX(10deg) rotateY(250deg);
        }
      }

      .confetti-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 1000;
        overflow: hidden;
        display: none;
      }

      .confetti {
        position: absolute;
        width: 10px;
        height: 10px;
        background-color: #ffd700;
        opacity: 0.7;
        top: -10px;
      }

      .confetti.slow {
        animation: confetti-slow 3.25s linear 1 forwards;
      }

      .confetti.medium {
        animation: confetti-medium 2.75s linear 1 forwards;
      }

      .confetti.fast {
        animation: confetti-fast 2.25s linear 1 forwards;
      }

      /* Enhanced Progress Bar */
      .progress-container {
        width: 100%;
        height: 10px;
        background-color: #e5e7eb;
        border-radius: 5px;
        margin: 15px 0;
        overflow: hidden;
      }

      .progress-bar {
        height: 100%;
        background: linear-gradient(
          90deg,
          var(--primary) 0%,
          var(--secondary) 100%
        );
        transition: width 0.5s ease;
        border-radius: 5px;
        position: relative;
      }

      /* Flip Clock Styles - REVISED */
      .flip-clock {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 5px;
        margin: 0 auto 1.5rem;
        flex-wrap: nowrap; /* Never wrap to ensure single row */
      }

      .flip-clock-section {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin: 0 2px;
      }

      .flip-clock-label {
        font-size: 0.75rem;
        color: var(--text-muted);
        margin-top: 5px;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .flip-clock-divider {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 60px;
        margin: 0 1px;
      }

      .flip-clock-divider span {
        width: 6px;
        height: 6px;
        background-color: var(--primary);
        border-radius: 50%;
        margin: 8px 0;
      }

      .flip-card {
        display: block;
        position: relative;
        width: 44px;
        height: 60px;
        perspective: 400px;
        margin: 0 1px;
      }

      .flip-card-top,
      .flip-card-bottom,
      .flip-card-back-top,
      .flip-card-back-bottom {
        position: absolute;
        left: 0;
        width: 100%;
        height: 50%;
        overflow: hidden;
        background-color: var(--surface);
        border: 1px solid rgba(0, 0, 0, 0.1);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .flip-card-top,
      .flip-card-back-top {
        top: 0;
        border-radius: 5px 5px 0 0;
        border-bottom: 0;
      }

      .flip-card-bottom,
      .flip-card-back-bottom {
        top: 50%;
        border-radius: 0 0 5px 5px;
        border-top: 0;
      }

      .flip-card-digit {
        position: absolute;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.8rem;
        font-weight: 700;
        color: var(--primary);
      }

      .flip-card-top .flip-card-digit,
      .flip-card-back-top .flip-card-digit {
        bottom: -30px;
        height: 60px;
      }

      .flip-card-bottom .flip-card-digit,
      .flip-card-back-bottom .flip-card-digit {
        top: -30px;
        height: 60px;
      }

      .flip-card-top {
        z-index: 3;
        backface-visibility: hidden;
        transform-origin: bottom center;
      }

      .flip-card-back-top {
        z-index: 1;
        transform: rotateX(180deg);
        backface-visibility: hidden;
        transform-origin: bottom center;
      }

      .flip-card-bottom {
        z-index: 2;
        transform-origin: top center;
      }

      .flip-card-back-bottom {
        z-index: 0;
        transform-origin: top center;
      }

      /* Animation for top card flipping down */
      @keyframes flipTop {
        0% {
          transform: rotateX(0deg);
        }
        100% {
          transform: rotateX(-180deg);
        }
      }

      /* Animation for bottom card flipping */
      @keyframes flipBottom {
        0% {
          transform: rotateX(0deg);
        }
        100% {
          transform: rotateX(180deg);
        }
      }

      .flip-card.active .flip-card-top {
        animation: flipTop 0.3s ease-in;
        animation-fill-mode: forwards;
      }

      .flip-card.active .flip-card-bottom {
        animation: flipBottom 0.3s ease-out;
        animation-fill-mode: forwards;
        animation-delay: 0.3s;
      }

      .flip-card-timestamp {
        display: none;
      }

      /* Improved Mobile Responsiveness */
      @media (max-width: 480px) {
        .card {
          padding: 1.5rem 0.75rem;
        }

        .flip-clock {
          gap: 2px;
          margin: 0 auto 1rem;
          width: 100%;
          justify-content: center;
          transform: scale(0.85);
          transform-origin: center top;
        }

        .flip-card {
          width: 30px;
          height: 40px;
          margin: 0;
        }

        .flip-card-digit {
          font-size: 1.2rem;
        }

        .flip-card-top .flip-card-digit,
        .flip-card-back-top .flip-card-digit {
          bottom: -20px;
          height: 40px;
        }

        .flip-card-bottom .flip-card-digit,
        .flip-card-back-bottom .flip-card-digit {
          top: -20px;
          height: 40px;
        }

        .flip-clock-divider {
          height: 40px;
          margin: 0;
        }

        .flip-clock-divider span {
          width: 3px;
          height: 3px;
          margin: 5px 0;
        }

        .flip-clock-label {
          font-size: 0.6rem;
          letter-spacing: 0;
        }

        .flip-clock-section {
          margin: 0;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>Recovery Journey</h1>
        <p class="subtitle">
          Track your progress and stay focused on your goal
        </p>
      </header>

      <div class="card">
        <div class="flip-clock" id="flip-clock">
          <!-- Flip clock will be generated by JavaScript -->
        </div>
        <div class="progress-container">
          <div class="progress-bar" id="progress-bar"></div>
        </div>
        <div class="days-label">Time of freedom</div>
        <p class="streak-info" id="streak-info">Your journey begins today!</p>
        <div class="achievement-message" id="achievement-message"></div>

        <button class="button" id="milestone-btn">Add a milestone</button>
        <button class="button button-danger" id="reset-btn">
          Reset counter
        </button>
      </div>

      <div class="card">
        <h2>Your milestones</h2>
        <div class="milestones" id="milestones-list">
          <div class="milestone">
            <span class="milestone-day">1</span>
            <span>First day completed</span>
            <button class="milestone-delete">×</button>
          </div>
          <div class="milestone">
            <span class="milestone-day">7</span>
            <span>One week milestone</span>
            <button class="milestone-delete">×</button>
          </div>
          <div class="milestone">
            <span class="milestone-day">30</span>
            <span>One month strong</span>
            <button class="milestone-delete">×</button>
          </div>
          <div class="milestone">
            <span class="milestone-day">90</span>
            <span>90-day transformation</span>
            <button class="milestone-delete">×</button>
          </div>
        </div>
      </div>

      <p class="quote">
        "Every day is a new opportunity to improve yourself. Don't give up."
      </p>

      <div class="card">
        <h2>Motivation Center</h2>
        <div class="motivation-sections">
          <div class="motivation-section" id="benefits-section">
            <h3>Benefits of Your Recovery Journey</h3>
            <div class="benefits-timeline">
              <div class="benefit-item">
                <div class="benefit-day">Day 1-7</div>
                <div class="benefit-desc">
                  <strong>Early Healing:</strong> Your body begins to restore
                  itself. Sleep improves, energy levels start to normalize, and
                  mental clarity begins to return.
                </div>
              </div>
              <div class="benefit-item">
                <div class="benefit-day">Day 8-30</div>
                <div class="benefit-desc">
                  <strong>Mental Shift:</strong> Brain chemistry starts balancing.
                  Mood swings decrease, anxiety reduces, and you'll experience
                  more moments of natural joy.
                </div>
              </div>
              <div class="benefit-item">
                <div class="benefit-day">Day 31-90</div>
                <div class="benefit-desc">
                  <strong>New Identity:</strong> You begin to see yourself
                  differently. Confidence grows, relationships improve, and new
                  healthy habits become established.
                </div>
              </div>
              <div class="benefit-item">
                <div class="benefit-day">Day 91+</div>
                <div class="benefit-desc">
                  <strong>Transformed Life:</strong> You've created sustainable
                  change. Your resilience is stronger, you have healthier coping
                  mechanisms, and your future is brighter.
                </div>
              </div>
            </div>
          </div>

          <div class="motivation-section" id="affirmations-section">
            <h3>Daily Affirmations</h3>
            <div class="affirmations-carousel">
              <div class="affirmations-container" id="affirmations-container">
                <!-- Affirmations will be populated by JavaScript -->
              </div>
              <div class="carousel-indicator">
                <span class="dot active"></span>
                <span class="dot"></span>
                <span class="dot"></span>
              </div>
            </div>
          </div>

          <div class="motivation-section" id="visualize-section">
            <h3>Visualization Exercise</h3>
            <p class="visualization-intro">
              Take a moment to visualize your recovery success:
            </p>
            <div class="visualization-carousel">
              <div class="visualization-prompt" id="visualization-prompt">
                <!-- Visualization prompts will be populated by JavaScript -->
              </div>
              <div class="carousel-indicator">
                <span class="dot active"></span>
                <span class="dot"></span>
                <span class="dot"></span>
              </div>
            </div>
          </div>
      </div>
    </div>

    <div class="confetti-container" id="confetti-container"></div>

    <footer>Recovery Journey Tracker &copy; 2025</footer>

    <script>
      // CSS for new motivation sections
      document.head.insertAdjacentHTML(
        "beforeend",
        `
        <style>
          .motivation-sections {
            display: flex;
            flex-direction: column;
            gap: 2rem;
          }
          
          .motivation-section {
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            animation: fadeIn 0.5s ease;
          }
          
          .motivation-section:last-child {
            border-bottom: none;
          }
          
          @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
          }
          
          .benefits-timeline {
            margin-top: 1rem;
          }
          
          .benefit-item {
            padding: 0.75rem 1rem;
            border-left: 5px solid var(--primary);
            margin-bottom: 1.25rem;
            position: relative;
            background-color: rgba(79, 70, 229, 0.05);
            border-radius: 0 8px 8px 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
          }
          
          .benefit-item:hover {
            transform: translateX(3px);
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
          }
          
          .benefit-day {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.25rem;
          }
          
          .benefit-desc {
            font-size: 0.9rem;
            color: var(--text);
            line-height: 1.4;
          }
          
          .affirmations-carousel,
          .visualization-carousel {
            position: relative;
            overflow: hidden;
          }
          
          .affirmations-container {
            background-color: rgba(16, 185, 129, 0.05);
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1rem 0;
            font-size: 1.1rem;
            text-align: center;
            font-weight: 500;
            color: var(--text);
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 0.5s ease;
          }
          
          .visualization-intro {
            margin-bottom: 1rem;
          }
          
          .visualization-prompt {
            background-color: rgba(6, 182, 212, 0.05);
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1rem 0;
            font-size: 1rem;
            color: var(--text);
            line-height: 1.5;
            min-height: 120px;
            transition: opacity 0.5s ease;
          }
          
          .carousel-indicator {
            display: flex;
            justify-content: center;
            margin-top: 10px;
          }
          
          .dot {
            height: 8px;
            width: 8px;
            margin: 0 4px;
            background-color: #bbb;
            border-radius: 50%;
            display: inline-block;
            transition: background-color 0.3s ease;
          }
          
          .dot.active {
            background-color: var(--primary);
          }
          
          @keyframes fadeInOut {
            0% { opacity: 0; }
            20% { opacity: 1; }
            80% { opacity: 1; }
            100% { opacity: 0; }
          }
        </style>
      `
      );

      // Get the current date in YYYY-MM-DD format
      function getCurrentDate() {
        const now = new Date();
        return `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(
          2,
          "0"
        )}-${String(now.getDate()).padStart(2, "0")}`;
      }
      // Calculate days between two dates
      function daysBetween(startDate, endDate) {
        const start = new Date(startDate);
        const end = new Date(endDate);
        const diffTime = Math.abs(end - start);
        const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
        return diffDays;
      }

      // Load start date from localStorage or set to today
      function loadStartDate() {
        const saved = localStorage.getItem("recoveryStartDate");
        if (saved) {
          return saved;
        } else {
          const today = getCurrentDate();
          localStorage.setItem("recoveryStartDate", today);
          return today;
        }
      }

      // Create a flip card element - IMPROVED VERSION
      function createFlipCard(value) {
        const flipCard = document.createElement("div");
        flipCard.className = "flip-card";
        flipCard.setAttribute("data-value", value);

        // Create the top half
        const topCard = document.createElement("div");
        topCard.className = "flip-card-top";
        const topDigit = document.createElement("div");
        topDigit.className = "flip-card-digit";
        topDigit.textContent = value;
        topCard.appendChild(topDigit);

        // Create the bottom half
        const bottomCard = document.createElement("div");
        bottomCard.className = "flip-card-bottom";
        const bottomDigit = document.createElement("div");
        bottomDigit.className = "flip-card-digit";
        bottomDigit.textContent = value;
        bottomCard.appendChild(bottomDigit);

        // Create the back top half (for flipping)
        const backTopCard = document.createElement("div");
        backTopCard.className = "flip-card-back-top";
        const backTopDigit = document.createElement("div");
        backTopDigit.className = "flip-card-digit";
        backTopDigit.textContent = value;
        backTopCard.appendChild(backTopDigit);

        // Create the back bottom half (for flipping)
        const backBottomCard = document.createElement("div");
        backBottomCard.className = "flip-card-back-bottom";
        const backBottomDigit = document.createElement("div");
        backBottomDigit.className = "flip-card-digit";
        backBottomDigit.textContent = value;
        backBottomCard.appendChild(backBottomDigit);

        // Assemble the card
        flipCard.appendChild(topCard);
        flipCard.appendChild(bottomCard);
        flipCard.appendChild(backTopCard);
        flipCard.appendChild(backBottomCard);

        return flipCard;
      }

      // Create a flip clock section (days, hours, minutes, seconds)
      function createFlipClockSection(label, value1, value2) {
        const section = document.createElement("div");
        section.className = "flip-clock-section";

        const cardsContainer = document.createElement("div");
        cardsContainer.className = "flip-clock-cards";
        cardsContainer.style.display = "flex";

        cardsContainer.appendChild(createFlipCard(value1));
        cardsContainer.appendChild(createFlipCard(value2));

        const labelElement = document.createElement("div");
        labelElement.className = "flip-clock-label";
        labelElement.textContent = label;

        section.appendChild(cardsContainer);
        section.appendChild(labelElement);

        return section;
      }

      // Create a divider for the flip clock
      function createFlipClockDivider() {
        const divider = document.createElement("div");
        divider.className = "flip-clock-divider";
        divider.innerHTML = "<span></span><span></span>";
        return divider;
      }

      // Initialize the flip clock
      function initializeFlipClock() {
        const clockContainer = document.getElementById("flip-clock");
        clockContainer.innerHTML = "";

        // Get the start date
        const startDate = new Date(loadStartDate());
        const now = new Date();

        // Calculate total seconds elapsed
        const totalSeconds = Math.floor((now - startDate) / 1000);

        // Calculate days, hours, minutes, seconds
        const days = Math.floor(totalSeconds / 86400);
        const hours = Math.floor((totalSeconds % 86400) / 3600);
        const minutes = Math.floor((totalSeconds % 3600) / 60);
        const seconds = totalSeconds % 60;

        // Create days section
        const daysSection = createFlipClockSection(
          "Days",
          String(Math.floor(days / 10)),
          String(days % 10)
        );
        clockContainer.appendChild(daysSection);

        // Divider
        clockContainer.appendChild(createFlipClockDivider());

        // Create hours section
        const hoursSection = createFlipClockSection(
          "Hours",
          String(Math.floor(hours / 10)),
          String(hours % 10)
        );
        clockContainer.appendChild(hoursSection);

        // Divider
        clockContainer.appendChild(createFlipClockDivider());

        // Create minutes section
        const minutesSection = createFlipClockSection(
          "Minutes",
          String(Math.floor(minutes / 10)),
          String(minutes % 10)
        );
        clockContainer.appendChild(minutesSection);

        // Divider
        clockContainer.appendChild(createFlipClockDivider());

        // Create seconds section
        const secondsSection = createFlipClockSection(
          "Seconds",
          String(Math.floor(seconds / 10)),
          String(seconds % 10)
        );
        clockContainer.appendChild(secondsSection);

        // Set last values to track changes
        window.lastFlipValues = [
          Math.floor(days / 10),
          days % 10,
          Math.floor(hours / 10),
          hours % 10,
          Math.floor(minutes / 10),
          minutes % 10,
          Math.floor(seconds / 10),
          seconds % 10,
        ];
      }

      // Flip a card to show a new value
      function flipCard(card, newValue) {
        // Only flip if the value is actually changing
        if (card.getAttribute("data-value") === String(newValue)) {
          return;
        }

        // Update back cards with new value
        const backTop = card.querySelector(
          ".flip-card-back-top .flip-card-digit"
        );
        const backBottom = card.querySelector(
          ".flip-card-back-bottom .flip-card-digit"
        );
        backTop.textContent = newValue;
        backBottom.textContent = newValue;

        // Start the flip animation
        card.classList.add("active");

        // After animation completes
        setTimeout(() => {
          // Update front cards with new value
          const frontTop = card.querySelector(
            ".flip-card-top .flip-card-digit"
          );
          const frontBottom = card.querySelector(
            ".flip-card-bottom .flip-card-digit"
          );
          frontTop.textContent = newValue;
          frontBottom.textContent = newValue;

          // Remove animation class
          card.classList.remove("active");

          // Store current value
          card.setAttribute("data-value", String(newValue));
        }, 600); // Wait for both animations to complete
      }

      // Update the flip clock - SIMPLIFIED VERSION
      function updateFlipClock() {
        // Get the start date
        const startDate = new Date(loadStartDate());
        const now = new Date();

        // Calculate total seconds elapsed
        const totalSeconds = Math.floor((now - startDate) / 1000);

        // Calculate days, hours, minutes, seconds
        const days = Math.floor(totalSeconds / 86400);
        const hours = Math.floor((totalSeconds % 86400) / 3600);
        const minutes = Math.floor((totalSeconds % 3600) / 60);
        const seconds = totalSeconds % 60;

        // Current values
        const values = [
          Math.floor(days / 10),
          days % 10,
          Math.floor(hours / 10),
          hours % 10,
          Math.floor(minutes / 10),
          minutes % 10,
          Math.floor(seconds / 10),
          seconds % 10,
        ];

        // Last values from previous update
        const lastValues = window.lastFlipValues || values;

        // Get all flip cards
        const flipCards = document.querySelectorAll(".flip-card");

        if (flipCards.length !== 8) {
          // If the structure is not ready, reinitialize
          initializeFlipClock();
          return;
        }

        // Update each card if value changed
        for (let i = 0; i < 8; i++) {
          if (values[i] !== lastValues[i]) {
            flipCard(flipCards[i], values[i]);
          }
        }

        // Store values for next comparison
        window.lastFlipValues = [...values];
      }

      // Update the counter
      function updateCounter() {
        const startDate = loadStartDate();
        const today = getCurrentDate();
        const days = daysBetween(startDate, today);

        // Update streak info text
        const streakInfo = document.getElementById("streak-info");
        if (days === 0) {
          streakInfo.textContent = "Your journey begins today!";
        } else if (days === 1) {
          streakInfo.textContent = "You completed your first day!";
        } else {
          streakInfo.textContent = `Started on ${new Date(
            startDate
          ).toLocaleDateString()}`;
        }

        // Update milestones
        updateMilestones(days);
      }

      // Reset the counter
      function resetCounter() {
        if (
          confirm(
            "Are you sure you want to reset your counter? This will set today as your new start date."
          )
        ) {
          const today = getCurrentDate();
          localStorage.setItem("recoveryStartDate", today);
          initializeFlipClock();
          updateCounter();
        }
      }

      // Show confetti animation
      function showConfetti() {
        const container = document.getElementById("confetti-container");
        container.style.display = "block";
        container.innerHTML = "";

        const colors = [
          "#ffd700",
          "#ff0000",
          "#00ff00",
          "#0000ff",
          "#ff00ff",
          "#00ffff",
        ];

        // Create confetti pieces
        for (let i = 0; i < 100; i++) {
          const confetti = document.createElement("div");
          confetti.className = "confetti";
          confetti.style.left = Math.random() * 100 + "vw";
          confetti.style.backgroundColor =
            colors[Math.floor(Math.random() * colors.length)];

          // Random shape
          if (Math.random() > 0.6) {
            confetti.style.borderRadius = "50%";
          } else if (Math.random() > 0.6) {
            confetti.style.width = "7px";
            confetti.style.height = "7px";
            confetti.style.transform = "rotate(45deg)";
          }

          // Random size
          const size = Math.random() * 12 + 5;
          confetti.style.width = size + "px";
          confetti.style.height = size + "px";

          // Random animation speed
          const animationSpeed = ["slow", "medium", "fast"];
          confetti.classList.add(
            animationSpeed[Math.floor(Math.random() * animationSpeed.length)]
          );

          container.appendChild(confetti);
        }

        // Remove confetti after animations complete
        setTimeout(() => {
          container.style.display = "none";
        }, 4000);
      }

      // Update progress bar
      function updateProgressBar(currentDays) {
        const progressBar = document.getElementById("progress-bar");
        const nextMilestone = getNextMilestone(currentDays);

        if (nextMilestone) {
          const prevMilestone = getPreviousMilestone(currentDays);
          const prevDay = prevMilestone ? parseInt(prevMilestone.day) : 0;
          const progress =
            ((currentDays - prevDay) / (nextMilestone.day - prevDay)) * 100;
          progressBar.style.width = progress + "%";
        } else {
          // All milestones completed
          progressBar.style.width = "100%";
        }
      }

      // Get the next milestone
      function getNextMilestone(currentDays) {
        const milestones = [];
        document.querySelectorAll(".milestone").forEach((milestone) => {
          const day = parseInt(
            milestone.querySelector(".milestone-day").textContent
          );
          const desc = milestone.querySelector("span:nth-child(2)").textContent;
          milestones.push({ day, desc });
        });

        milestones.sort((a, b) => a.day - b.day);

        for (const milestone of milestones) {
          if (milestone.day > currentDays) {
            return milestone;
          }
        }

        return null; // All milestones completed
      }

      // Get the previous completed milestone
      function getPreviousMilestone(currentDays) {
        const milestones = [];
        document.querySelectorAll(".milestone").forEach((milestone) => {
          const day = parseInt(
            milestone.querySelector(".milestone-day").textContent
          );
          const desc = milestone.querySelector("span:nth-child(2)").textContent;
          milestones.push({ day, desc });
        });

        milestones.sort((a, b) => b.day - a.day); // Sort descending

        for (const milestone of milestones) {
          if (milestone.day <= currentDays) {
            return milestone;
          }
        }

        return null;
      }

      // Update achievement message
      function updateAchievementMessage(currentDays) {
        const achievementMsg = document.getElementById("achievement-message");
        const milestones = document.querySelectorAll(".milestone");
        const justCompletedMilestones = [];

        // Check for just-completed milestones (within the last day)
        milestones.forEach((milestone) => {
          const daySpan = milestone.querySelector(".milestone-day");
          const targetDay = parseInt(daySpan.textContent);
          const description =
            milestone.querySelector("span:nth-child(2)").textContent;

          if (targetDay === currentDays) {
            justCompletedMilestones.push({ day: targetDay, desc: description });
          }
        });

        if (justCompletedMilestones.length > 0) {
          // Show achievement message and confetti
          const milestone = justCompletedMilestones[0]; // Just show the first one if multiple
          achievementMsg.textContent = `🎉 Congratulations! You've reached day ${milestone.day}: "${milestone.desc}"`;
          achievementMsg.style.display = "block";
          showConfetti();
        } else {
          achievementMsg.style.display = "none";
        }
      }

      // Update milestones based on current streak
      function updateMilestones(currentDays) {
        const milestones = document.querySelectorAll(".milestone");
        let justCompleted = false;

        milestones.forEach((milestone) => {
          const daySpan = milestone.querySelector(".milestone-day");
          const targetDay = parseInt(daySpan.textContent);
          const wasComplete =
            milestone.classList.contains("milestone-complete");

          if (currentDays >= targetDay) {
            milestone.classList.add("milestone-complete");

            // Check if this milestone was just completed
            if (!wasComplete && currentDays === targetDay) {
              justCompleted = true;
            }
          } else {
            milestone.classList.remove("milestone-complete");
          }
        });

        // Update progress bar
        updateProgressBar(currentDays);

        // Show achievement message for newly completed milestones
        updateAchievementMessage(currentDays);

        return justCompleted;
      }

      // Delete a milestone
      function deleteMilestone(event) {
        const milestone = event.target.closest(".milestone");
        if (
          milestone &&
          confirm("Are you sure you want to delete this milestone?")
        ) {
          milestone.remove();
          saveMilestones();

          // Update milestone status and progress
          const currentDays = daysBetween(loadStartDate(), getCurrentDate());
          updateMilestones(currentDays);
        }
      }

      // Add a custom milestone
      function addMilestone() {
        const targetDay = prompt("Enter the day for your milestone:");
        const description = prompt("Enter a description for this milestone:");

        if (targetDay && description) {
          const milestone = document.createElement("div");
          milestone.className = "milestone";

          const daySpan = document.createElement("span");
          daySpan.className = "milestone-day";
          daySpan.textContent = targetDay;

          const descSpan = document.createElement("span");
          descSpan.textContent = description;

          const deleteBtn = document.createElement("button");
          deleteBtn.className = "milestone-delete";
          deleteBtn.innerHTML = "×";
          deleteBtn.addEventListener("click", deleteMilestone);

          milestone.appendChild(daySpan);
          milestone.appendChild(descSpan);
          milestone.appendChild(deleteBtn);

          document.getElementById("milestones-list").appendChild(milestone);

          // Check if this milestone is already complete
          const currentDays = daysBetween(loadStartDate(), getCurrentDate());
          if (currentDays >= parseInt(targetDay)) {
            milestone.classList.add("milestone-complete");
            showConfetti();
          }

          // Save to localStorage
          saveMilestones();

          // Update progress bar
          updateProgressBar(currentDays);
        }
      }

      // Save milestones to localStorage
      function saveMilestones() {
        const milestones = [];
        document.querySelectorAll(".milestone").forEach((milestone) => {
          const day = milestone.querySelector(".milestone-day").textContent;
          const desc = milestone.querySelector("span:nth-child(2)").textContent;
          milestones.push({ day, desc });
        });

        localStorage.setItem("recoveryMilestones", JSON.stringify(milestones));
      }

      // Load milestones from localStorage
      function loadMilestones() {
        const saved = localStorage.getItem("recoveryMilestones");
        if (saved) {
          const milestones = JSON.parse(saved);
          const container = document.getElementById("milestones-list");
          container.innerHTML = "";

          milestones.forEach((item) => {
            const milestone = document.createElement("div");
            milestone.className = "milestone";

            const daySpan = document.createElement("span");
            daySpan.className = "milestone-day";
            daySpan.textContent = item.day;

            const descSpan = document.createElement("span");
            descSpan.textContent = item.desc;

            const deleteBtn = document.createElement("button");
            deleteBtn.className = "milestone-delete";
            deleteBtn.innerHTML = "×";
            deleteBtn.addEventListener("click", deleteMilestone);

            milestone.appendChild(daySpan);
            milestone.appendChild(descSpan);
            milestone.appendChild(deleteBtn);
            container.appendChild(milestone);
          });

          // Update milestone statuses
          const currentDays = daysBetween(loadStartDate(), getCurrentDate());
          updateMilestones(currentDays);
          updateProgressBar(currentDays);
        }
      }

        // Initialize the page
      document.addEventListener("DOMContentLoaded", () => {
        // Initialize flip clock
        initializeFlipClock();

        // Immediately trigger a clock update to ensure it's visible
        updateFlipClock();

        // Set up reset button
        document
          .getElementById("reset-btn")
          .addEventListener("click", resetCounter);

        // Set up milestone button
        document
          .getElementById("milestone-btn")
          .addEventListener("click", addMilestone);

        // Set up delete buttons
        document.querySelectorAll(".milestone-delete").forEach((btn) => {
          btn.addEventListener("click", deleteMilestone);
        });

        // Load milestones
        loadMilestones();

        // Update counter on page load
        updateCounter();

        // Generate random motivational quote
        const quotes = [
          "Every day is a new opportunity to improve yourself. Don't give up.",
          "Progress is progress, no matter how small.",
          "You're stronger than you think. Keep going!",
          "Your determination today shapes your success tomorrow.",
          "The journey of a thousand miles begins with a single step.",
          "Every day clean is a victory worth celebrating.",
          "You've come too far to give up now.",
          "Be proud of how far you've come and have faith in how far you can go.",
          "Recovery isn't just about stopping; it's about creating a new life.",
          "Fall down seven times, stand up eight.",
          "Your future self is watching you right now through memories.",
          "The best time to plant a tree was 20 years ago. The second best time is now.",
          "Recovery is not a race; you don't have to feel guilty if it takes you longer than you thought it would.",
          "The only person you should try to be better than is the person you were yesterday.",
          "Small steps lead to big changes.",
          "Every moment is a fresh beginning.",
          "Trust the process. Your time is coming.",
          "You are not defined by your past. You are prepared by it.",
          "The harder the battle, the sweeter the victory.",
          "Recovery is about progression, not perfection.",
          "The strongest people are not those who show strength in front of us but those who win battles we know nothing about.",
          "It's okay to not be okay as long as you're not giving up.",
          "Today I am better than I was yesterday, and tomorrow I will be better than I am today.",
          "The pain you feel today will be the strength you feel tomorrow.",
          "Courage doesn't always roar. Sometimes it's the quiet voice saying 'I will try again tomorrow'.",
          "Your recovery is a testament to your strength.",
          "When you feel like quitting, remember why you started.",
          "The greatest glory in living lies not in never falling, but in rising every time we fall.",
          "Every accomplishment begins with the decision to try.",
          "Healing is not linear. It's okay to have setbacks, just don't give up.",
        ];

        document.querySelector(".quote").textContent = `"${
          quotes[Math.floor(Math.random() * quotes.length)]
        }"`;

        // Affirmations array
        const affirmations = [
          "I am stronger than my challenges and braver than my fears.",
          "Every day I'm getting healthier and stronger.",
          "I have the power to change my story.",
          "My recovery journey is worth every effort I make.",
          "I deserve happiness and a healthy life.",
          "I am capable of amazing change.",
          "My potential is limitless.",
          "I am in control of my choices and my future.",
          "Today, I choose progress over perfection.",
          "I am resilient and can overcome any obstacle.",
          "I am worthy of a healthy, balanced life.",
          "I trust in my ability to make positive changes.",
          "My struggles do not define me; my strength does.",
          "I am creating a life I love.",
          "Every step forward is a victory worth celebrating.",
          "I am patient with myself as I heal and grow.",
          "I release the past and embrace my new beginning.",
          "I am committed to my well-being.",
          "I radiate strength, resilience, and determination.",
          "I am not alone in this journey.",
        ];

        // Visualization prompts
        const visualizationPrompts = [
          "Imagine waking up one year from now. You feel refreshed, energized, and at peace. What does your morning routine look like? What thoughts go through your mind?",
          "Picture yourself in a situation that used to trigger you, but now you're handling it with ease and confidence. What new skills or strengths do you have?",
          "Visualize someone close to you noticing how far you've come. What changes do they see in you? How does their recognition make you feel?",
          "See yourself engaged in a healthy activity that brings you joy. What are you doing? Who are you with? How does it feel to be fully present?",
          "Imagine writing a letter to your future self describing your recovery journey. What obstacles did you overcome? What are you most proud of?",
          "Picture yourself helping someone who is where you once were. What wisdom would you share? How does it feel to be a source of inspiration?",
          "Visualize a peaceful place where you feel completely safe and content. What does it look like? What sounds do you hear? How does it feel to be there?",
          "See yourself celebrating a significant recovery milestone. Who is celebrating with you? How are you commemorating this achievement?",
          "Imagine your life free from what once held you back. What new opportunities are available to you? What dreams are you pursuing?",
          "Picture the healthy relationships in your life growing stronger. How have they improved? What new connections have you made?",
        ];

        // Auto-rotating affirmations and visualizations
        let currentAffirmationIndex = 0;
        let currentVisualizationIndex = 0;
        
        function rotateAffirmations() {
          const container = document.getElementById("affirmations-container");
          const dots = document.querySelectorAll("#affirmations-section .dot");
          
          // Fade out
          container.style.opacity = 0;
          
          setTimeout(() => {
            // Update content while it's invisible
            currentAffirmationIndex = (currentAffirmationIndex + 1) % affirmations.length;
            container.textContent = affirmations[currentAffirmationIndex];
            
            // Update indicator dots
            dots.forEach((dot, i) => {
              dot.classList.toggle("active", i === currentAffirmationIndex % 3);
            });
            
            // Fade in
            container.style.opacity = 1;
          }, 500);
        }
        
        function rotateVisualizations() {
          const container = document.getElementById("visualization-prompt");
          const dots = document.querySelectorAll("#visualize-section .dot");
          
          // Fade out
          container.style.opacity = 0;
          
          setTimeout(() => {
            // Update content while it's invisible
            currentVisualizationIndex = (currentVisualizationIndex + 1) % visualizationPrompts.length;
            container.textContent = visualizationPrompts[currentVisualizationIndex];
            
            // Update indicator dots
            dots.forEach((dot, i) => {
              dot.classList.toggle("active", i === currentVisualizationIndex % 3);
            });
            
            // Fade in
            container.style.opacity = 1;
          }, 500);
        }

        // Update the flip clock every second
        const clockInterval = setInterval(updateFlipClock, 1000);

        // Initialize affirmations and visualizations with first items
        document.getElementById("affirmations-container").textContent = 
          affirmations[currentAffirmationIndex];
        document.getElementById("visualization-prompt").textContent = 
          visualizationPrompts[currentVisualizationIndex];
        
        // Set up auto-rotation intervals
        const affirmationInterval = setInterval(rotateAffirmations, 8000); // Change every 8 seconds
        const visualizationInterval = setInterval(rotateVisualizations, 12000); // Change every 12 seconds
        // Force the first update
        updateFlipClock();
      });
    </script>
  </body>
</html>
